<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Cinestar_app.Models"
             x:Class="Cinestar_app.Filmovi"
             BackgroundColor="#051851"
             Title="Filmovi">

    <Grid RowDefinitions="Auto,Auto,*"
          Padding="10">

        <!-- Grad -->
        <Label Grid.Row="0"
               Text="{Binding SelectedCity}"
               TextColor="#FFD200"
               FontAttributes="Bold"
               FontSize="18">
            <Label.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnCityTapped"/>
            </Label.GestureRecognizers>
        </Label>

        <!-- Zanr -->
        <Picker Grid.Row="1"
                x:Name="GenrePicker"
                Title="Filter po zanru"
                TextColor="White"
                SelectedIndexChanged="OnGenreChanged"/>

        <!-- Filmovi -->
        <CollectionView Grid.Row="2"
                        x:Name="FilmsCollectionView"
                        SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Film">
                    <Frame BackgroundColor="#0B2A6F"
                           CornerRadius="16"
                           Padding="10"
                           Margin="5">

                        <!-- TapGesture za navigaciju -->
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFilmTapped"/>
                        </Frame.GestureRecognizers>

                        <Grid ColumnDefinitions="120,*">
                            <Image Source="{Binding Poster}"
                                   HeightRequest="180"
                                   Aspect="AspectFill"/>

                            <StackLayout Grid.Column="1"
                                         Padding="10"
                                         Spacing="6">

                                <Label Text="{Binding Title}"
                                       TextColor="White"
                                       FontAttributes="Bold"/>

                                <Label Text="{Binding Genre}"
                                       TextColor="#FFC107"
                                       FontSize="12"/>

                                <Label Text="{Binding Year}"
                                       TextColor="White"
                                       FontSize="12"/>

                                <StackLayout Orientation="Horizontal"
                                             Spacing="6"
                                             Margin="0,10,0,0">
                                    <Button Text="12:00" Clicked="OnReserveClicked"/>
                                    <Button Text="15:00" Clicked="OnReserveClicked"/>
                                    <Button Text="18:00" Clicked="OnReserveClicked"/>
                                </StackLayout>

                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

        <!-- Loading overlay -->
        <Grid x:Name="LoadingOverlay"
              BackgroundColor="#80000000"
              IsVisible="False"
              VerticalOptions="FillAndExpand"
              HorizontalOptions="FillAndExpand"
              RowSpan="3">

            <StackLayout VerticalOptions="Center"
                         HorizontalOptions="Center"
                         Spacing="10">
                <ActivityIndicator IsRunning="True" Color="#FFD200" WidthRequest="60" HeightRequest="60"/>
                <Label Text="Učitavanje filmova..."
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </StackLayout>
        </Grid>

    </Grid>
</ContentPage>
