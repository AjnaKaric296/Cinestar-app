<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Cinestar_app.Models"
             x:Class="Cinestar_app.Filmovi"
             Title="Filmovi">

    <!-- Gradient pozadina -->
    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#051851" Offset="0.0"/>
            <GradientStop Color="#0B2A6F" Offset="1.0"/>
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid RowDefinitions="Auto,Auto,*" Padding="10">

        <!-- Header: logo + grad + strelica -->
        <Grid HeightRequest="60" Padding="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Logo lijevo -->
            <Image Source="logo.png" HeightRequest="100" WidthRequest="100" Grid.Column="0" VerticalOptions="Center"/>

            <!-- Spacer -->
            <BoxView Grid.Column="1" WidthRequest="10"/>

            <!-- Grad + strelica desno -->
            <StackLayout Orientation="Horizontal" Grid.Column="2" VerticalOptions="Center" Spacing="10">
                <Label x:Name="CityLabel"
                       Text="{Binding SelectedCity}"
                       TextColor="#FFD200"
                       FontAttributes="Bold"
                       FontSize="16"
                       VerticalOptions="Center">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCityTapped"/>
                    </Label.GestureRecognizers>
                </Label>
                <Image Source="strelica.png"
                       HeightRequest="10"
                       WidthRequest="10"
                       VerticalOptions="Center"/>
            </StackLayout>
        </Grid>

        <!-- Zanr -->
        <Picker Grid.Row="1"
                x:Name="GenrePicker"
                Title="Filter po žanru"
                TextColor="White"
                SelectedIndexChanged="OnGenreChanged"
                HorizontalOptions="Fill"
                Margin="0,10,0,0"/>

        <!-- Filmovi -->
        <CollectionView Grid.Row="2"
                        x:Name="FilmsCollectionView"
                        SelectionMode="None"
                        Margin="0,10,0,0">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Film">
                    <Frame BackgroundColor="#0B2A6F"
                           CornerRadius="20"
                           Padding="12"
                           Margin="8">

                        <!-- TapGesture za navigaciju -->
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFilmTapped"/>
                        </Frame.GestureRecognizers>

                        <Grid ColumnDefinitions="120,*">
                            <Image Source="{Binding Poster}"
                                   HeightRequest="180"
                                   WidthRequest="120"
                                   Aspect="AspectFill"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"/>

                            <StackLayout Grid.Column="1"
                                         Padding="10"
                                         Spacing="8">

                                <Label Text="{Binding Title}"
                                       TextColor="White"
                                       FontAttributes="Bold"
                                       FontSize="18"
                                       LineBreakMode="TailTruncation"/>

                                <Label Text="{Binding Genre}"
                                       TextColor="#FFC107"
                                       FontSize="13"
                                       LineBreakMode="TailTruncation"/>

                                <Label Text="{Binding Year}"
                                       TextColor="White"
                                       FontSize="13"/>

                                <ScrollView Orientation="Horizontal" Margin="0,10,0,0">
                                    <HorizontalStackLayout Spacing="8">
                                        <Button Text="12:00" Clicked="OnReserveClicked" BackgroundColor="#FFD200" TextColor="#051851" CornerRadius="15" Padding="10,5"/>
                                        <Button Text="15:00" Clicked="OnReserveClicked" BackgroundColor="#FFD200" TextColor="#051851" CornerRadius="15" Padding="10,5"/>
                                        <Button Text="18:00" Clicked="OnReserveClicked" BackgroundColor="#FFD200" TextColor="#051851" CornerRadius="15" Padding="10,5"/>
                                        <!-- Možeš dodati još termina -->
                                        <Button Text="21:00" Clicked="OnReserveClicked" BackgroundColor="#FFD200" TextColor="#051851" CornerRadius="15" Padding="10,5"/>
                                    </HorizontalStackLayout>
                                </ScrollView>

                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

        <!-- Loading overlay -->
        <Grid x:Name="LoadingOverlay"
              BackgroundColor="#80000000"
              IsVisible="False"
              VerticalOptions="FillAndExpand"
              HorizontalOptions="FillAndExpand"
              RowSpan="3">

            <StackLayout VerticalOptions="Center"
                         HorizontalOptions="Center"
                         Spacing="10">
                <ActivityIndicator IsRunning="True" Color="#FFD200" WidthRequest="60" HeightRequest="60"/>
                <Label Text="Učitavanje filmova..."
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </StackLayout>
        </Grid>

    </Grid>
</ContentPage>
